# ДЗЕН

## 1. Тема и целевая аудитория

Выбран сервис dzen

Дзен — российская блог-платформа для создания и просмотра контента

Аудитория:
- MAU 79M [7] и [8]
- DAU 31M [9]

По странам [8]:
1. Россия - 95,43% - 75,3М
2. Беларусь - 1,14% - 0,9М
3. Казахстан - 0,55% - 0,4М
4. Украина - 0,44% - 0,35М

Ключевой функционал - просмотр и реакция на посты

Ключевое продуктовое решение - весь контент создаётся пользователями

Выделен следующий функционал MVP:
- Поиск (по постам, авторам)
- Чтение постов
- Написание постов с вложением картинок
- Комментарии
- Авторизация
+ Подписки
+ Рекомендации
+ Монетизация

## 2. Расчет нагрузки

Анализ трафика:

- 100 млн пользователей [1]
- 2,7 млн постов ежемесячно [2]
- 100к пользователей пишут ежемесячно [3]
- 500к коментариев ежедневно, но тогда DAU был 20М, а сейчас 31М => 750к [4]
- 5 млрд часов проведено на сайте за год (2024) [6]
- добавляется 1 млн авторов ежегодно [6]
- время пользователей : 40% видео, 60% текстов [5]

Средний размер хранилища пользователя 5,55 мб:
- 1,5 Мб фотография

    вычислил путём среднего от 10 фотографий (не иконок которые меньше весят). Получили: (406 + 6100 + 143 + 120 + 4400 + 108 + 222 + 380 + 1400 + 543)кб / 10 = 13824 кб / 10 ~= 1,5 Мб

- 50кб коментариев

  по [17] с 2019 года начался основной рост (с 8,7М DAU -> 13M DAU) будем считать что средний возраст профиля 5-6 лет т.е. 5,5 лет т.е 2000 дней. По таблице ниже каждый день пользователь делает 0,025 коментариев => 2000 * 0,025 = 50 коментариев. Средний вес коментария 1кб => 50кб

- 2 поста

  аналогично с коментариями 2000 * 0,001 = 2. Пост в среднем весит 2048кб ~= 2 мб => 2 * 2 = 4мб постов


- 3 Кб Информация о пользователе
  - 140 символов * 2 байта = 280 байт на имя
  - 300 * 2 = 600 байт на описание
  - 1 Кб на ссылки (свой сайт, на соцсети)

Действия пользователя:

|Действие|Количество а пользователя|Обоснование|
|--|--|--|
|Главная|1|При на жатии на интересный пост открывается новая вкладка и заходить на главную не надо можно просто закрыть вкладку со статьёй|
|Чтение статьи|15|В среднем пользователь проводить 18 минут за чтением статей: 5 млрд часов[6] * 0.63 процент чтения статей[6] / 365 дней / 30млн пользователей ежедневно * 60 минут в часу<br> По статистике канала "Упал поднялся" Статью читают 1,2 минуты[13] crt 0,09. Значит за день пользователь читает 15 статей|
|Написание статьи|0,001|Ежемесячно 100 000 авторов[6] пишут 2,7 млн постов[2]. Примерно 27 пост на автора или 0,9 поста в день. При MAU 79M в среднем пользователь пишет 0,034 постов в месяц или 0,001 пост в день|
|Коментарии|0,025|в день оставляют 750к[4] коментариев значит при DAU 31M пользователь пишет 0,025 коментариев в день|
|Коментарии(чтение)|6,6|При дочитывании статьи появляются коментарии. На основе статистики канала "Упал поднялся" статью дочитывают 44% человек. Отсюда 15 * 0,44 = 6,6|
|Регистрация|0,00009|1 млн авторов регестрируются ежегодно[6]. Значит в день регестрируются 2,8к пользователей. При DAU 31М получаем 0,00009|
|Подписка|0,002|По статистики zenstats на 50 самый больших каналов[12] по подписчикам подписалось за месяц 500к. Прогназирую 5М подписок ежемесячно. Значит при MAU 79M каждый пользовать сделал 0,07 подписок в месяц или 0,002 подписки в день|
|Рекомендации|17,5|(10000 rps[1] * 86400 сек / 31M DAU) * 0,63 процент чтения статей = 17,5 запросов к рекомендациям|
|Монетизация|-|-|
|Поиск|0,27|1,8 % людей переходят на посты[14] . В других источниках нет нормальных процентов (<1%)<br> 15 * 0,018 = 0,27|


- 1 раз в день пользователь заходит на главную. При нажатии на интересный пост открывается новая вкладка => 2 раз заходить на главную не надо.
- В среднем пользователь проводит 18 минут за чтением статей (5 млрд часов * 0.63 процент чтения статей / 365 дней / 30млн пользователей ежедневно * 60 минут в часу)
- По статистике канала "Упал поднялся" Статью читают 1,2 минуту. Значит за день пользователь читает 18 статей
- Ежемесячно 100 000 авторов пишут 2,7 млн постов. Примерно 27 пост на автора или 0,9 поста в день. При MAU 79M в среднем пользователь пишет 0,034 постов в месяц или 0,001 пост в день
- в день оставляют 750к коментариев значит при DAU 31M пользователь пишет 0,025 коментариев в день
- 1 млн авторов регестрируются ежегодно. Значит в день регестрируются 2,8к пользователей. При DAU 31М получаем 0,00009
- По статистики zenstats на 50 самый больших каналов по подписчикам подписалось за месяц 500к. Прогназирую 5М подписок ежемесячно. Значит при MAU 79M каждый пользовать сделал 0,07 подписок в месяц или 0,002 подписки в день
- По рекомендациям есть 10k rps
- По монетизации ничего пока нету :(

Разбивка по данным:

|Табличка|Размер|Обоснование|
|--|--|--|
|Пользователи|300 Гб (48 Тб с аватаром)|Всего пользователей 100млн[1] => 3 Кб данных о пользователе * 100 000 000 = 300 Гб.<br> Если считать с картинками, то 1,503 Мб * 100 000 000 = 144 Тб, но эти данные завышены так как не у всех пользователей есть аватарки. Сервис предоставляет 3 вида аватарок (белый человечек, абстракция, животные ии (штук 20)).<br> Я взял для анализа коментарии следующей статьи https://dzen.ru/a/aMh3qNPKJCJqDMDH - 396 коментаиев из которых ~= 105 с автарками. Сделаем погрешность и будет считать что каждый третий пользователь имеет аватарку (33,4 * 1,503 мб + 66,6 * 0,003 мб) * 1 000 000 = 48 Тб данных|
|Посты|976 Гб (245 тб с фото)|в 2023 году 20 млн постов и 14 млн статей. Это на 40% больше чем в прошлом году[15] => В прошлом году было 34 * 0,6 = 20 млн постов <br> в 2022 году[16] количество контента вырасло в 3 раза => В прошлом году было 20 / 3 ~= 8 млн постов <br> С 2015 - 2021 (6 лет) = 8 * 6 = 24. Т.к. за 6 лет произошёл рост аудитории сократим количество постов до 20 млн. <br> Итого: 40 (в 2024 прогназируем) + 34 + 20 + 8 + 20 = 122 млн постов <br>Взял 50 постов на zenstat[2] и вычислил среднее время = 4 минуты это примерно 4000 символов [11] ~= 8кб (uft8) <br> 8кб * 122млн = 976 Гб. В среднем на 1 пост 6 картинок. Средний вес картинки 340 кб => 6 * 340кб = 2 мб => 122млн * 2мб = 244 тб фото или 245 тб если считать и текст|
|Коментарии|2тб|В 2020 году пользователи писали 500к коментариев[4] => 10 лет * 365 дней * 500к ~= 2 млрд коментариев. Взял такое число потому что 2020 ровно середина между 2015 (создание) и 2025 годом. Тогда DAU был 20М, а сейчас 31М. В среднем один коментарий весит 1 кб (рассчитано средним по статье) => 2 млрд * 1 кб = 2 тб|

- Всего пользователей 100М => 1,503 Мб * 100 000 000 = 144 Тб
  - 1,5 Мб * 100 000 000 = 143 Тб - эти данные завышены так как не у всех пользователей есть аватарки. Серевис предоставляет 3 вида аватарок (белый человечек, абстракция, животные ии (штук 20))
  - 0,003 Мб * 100 000 000 = 300 Гб

  - Я взял для анализа коментарии следующей статьи https://dzen.ru/a/aMh3qNPKJCJqDMDH - 396 коментаиев из которых ~= 105 с автарками. Сделаем погрешность и будет считать что каждый третий пользователь имеет аватарку (33,4 * 1,503 + 66,6 * 0,003) * 1 000 000 = 48 Тб данных
- Посты:
  - в 2023 году 20 млн постов и 14 млн статей. Это на 40% больше чем в прошлом году => В прошлом году было 34 * 0,6 = 20 млн постов
  - в 2022 году количество контента вырасло в 3 раза => В прошлом году было 20 / 3 ~= 8 млн постов
  - С 2015 - 2021 (6 лет) = 8 * 6 = 24. Т.к. за 6 лет произошёл рост аудитории сократим количество постов до 20 млн.
  - Итого: 40 (в 2024 прогназируем) + 34 + 20 + 8 + 20 = 122 млн постов
  - Взял 50 постов на zenstat и вычислил среднее время = 4 минуты это примерно 4000 символов [11] ~= 8кб (uft8)
  - 8кб * 122млн = 976 Гб
  - В среднем 6 картинок в посте (минимум 1, максимум 22 но очень длинная статья, в обычных по 4 фото)
  - Средний вес картинки (смотрел черерз network): 340кб
  - Вместе с картинками (340 кб * 6 + 8 кб) * 122 млн = 244 тб
  - В 2020 году пользователи писали 500к коментариев => 10 лет * 365 дней * 500к ~= 2 млрд коментариев
  - В среднем коментарий весит = (22 561 символа * 2 байта) / 48 = 940байт ~= 1 кб
  - Значит всего 2 млрд * 1 кб = 2 тб 

Rps и сетевая нагрузка:
|Действие|RPS|RPS пик|Сеть|Сеть пик|Сеть в день|
|--|--|--|--|--|--|
|Лента постов|360|792|3,7 Гб/c|8,2 гб/c| 322,4 тб|
|Чтение постов|5 400|11 800|12,4 гб/с|27 гб/c|1 Пб|
|Написание постов|1|2,2|2,3 мб/с|4,6 мб/c| 207 гб|
|Коментарии|9|19|9 кб/с|19 кб/с|750 мб|
|Коментарии(чтение)|2 400|5 200|19,2 мб/с|41,6 мб/c|1,63 тб|
|Рекомендации|6 300|13 900|31 мб/с|70 мб/c|3,8 Тб|
|Регистрация|0,001|0,003|0,005 кб/c|0,0015кб/c|14 мб|
|Подписка|0,7|1,5|1,4 кб/c|4,1 кб/c|61 мб|
|Монетизация|-|-|-|-|
|Поиск|96|211|0,5 мб/с|11 мб/с|42гб|

Рассмотрим трафик однокласников (похожая аудитория и её расположение)
<img width="786" height="425" alt="image" src="https://github.com/user-attachments/assets/def8a2d2-9a2a-47ce-8dfb-f7c9d033f4d2" />
Пик 1500. низ 125 => (1500 - 125) / 2 = 687 => 1500 / 687 = 2,2 - пиковая нагрузка


- Лента постов
  - (307 + 211 + 403 + 882 + 520 + 5 + 93) / 7 = 2421 кб / 7 = 345 кб на шапку поста
  - 0,4 кб (200 символов) на короткое вступление
  - 1кб на пост (ссылки на аватарку и шапку поста, имя пользователя, время чтения и вступление)
  - Размер аватарки автора поста ~= 2кб
  - Личный опыт - листается порядка 30 постов на главной => (345 + 2 + 1) * 30 = 10,4 мб картиной
  - 31 000 000 / 86 400 = 360 rps в среднем => 360 * 10,4 = 3,7 Гб/c
  - 360 * 2,2 = 792 rps в пике => 792 rps * 30 постов * 1кб = 24 мб/с в пике текста или 792 * 10,4 мб = 8,2 гб/c в пике с картинками
  - 31 000 000 * 30 постов * 1 кб = 930 гб трафика в день или 31 000 000 * 10,4 мб = 322,4 Тб с картинками
- Пост
  - 8 кб текст поста
  - В посте в среднем 5,6 картинок по 411 кб = 2,2мб картинок на пост + 8 кб поста= 2,3мб
  - (15 статей в день * 31 000 000 DAU) / 86 400 = 5 400 rps в среднем => 5 400 * 2,3 = 12,4 гб/c в среднем
  - 5 400 * 2,2  = 11 800 rps в пике => 11 800 * 16кб = 190 мб/c текста или 11 800 * 2,3 мб = 27 гб/с с картинками
  - 31 000 000 DAU * 15 статей в день * 8 кб текста = 3,7 Тб трафика в день или 31 000 000 DAU * 15 статей в день * 2,3мб = 1 пб в день
- Написание постов
  - В день 2 700 000 постов в месяц / 30 дней = 90 000 => 90 000 постов в день / 86 400 секунд = 1 rps в среднем => 1 * 2,3 = 2,3 мб/c в среднем
  - В посте в среднем 5,6 картинок по 411 кб = 2,3мб картинок на пост (ещё пост 8 кб)
  - В пике 1 rps * 2,2 = 2 rps в пике => 2 * 8 kb = 16 кб/с или 2 * 2,3мб = 4,6 мб/c
  - 2 700 000 * 8кб / 30 = 720 Мб трафика в день или 2 700 000 * 2,3 мб / 30 = 207 гб трафика в день
- Коментарии
  - Средний размер коментария ~= 1кб
  - 750 000 / 86 400 = 9 rps => 9 кб/c в среднем
  - Пиковый = 9 * 2,2 = 19 rps => 19 rps * 1 кб = 19 кб /c в пике
  - 750 000 * 1 кб = 750 Мб трафика в день
- Коментарии (чтение)
  - Средний размер коментария ~= 1кб
  - 750к коментариев в день * 30 дней = 22 500 000 коментариев в месяц. 22,5М коментариев / 2,7 млн постов = 8 коментариев на пост = 8 кб
  - 6,6 * 31 000 000 DAU * 8 кб = 1,63 Тб трафика в день
  - (6,6 чтений в день * 31 000 000 DAU) / 86 400 = 2 400 RPS => 2 400 * 8кб = 19,2 мб/c
  - 2 400 * 2,2 = 5 200 RPS в пике => 5200 * 8кб = 41,6 мб/c
- Подписка
  - Пусть вес запроса будет 1кб
  - (0,002 подписок в день * 31 000 000 DAU) / 86 400 = 0,7 RPS => 0,7 RPS * 1кб = 1 кб/c в среднем
  - 0,7 RPS * 2,2 = 1,5 RPS => 1,5 * 1 = 1,5 кб/c в пике
  - 0,7 RPS * 86 400 с * 1кб = 61 мб трафика в день
- Регистрация
  - Пусть вес запроса будет 5кб
  - 0,00009 в день * 31 000 000 DAU / 86 400 = 0,001 RPS (на калькуляторе ещё меньше я не хочу вводить 0) => 0,001 * 5 = 0,005кб/c
  - 0,001 RPS * 2,2 = 0,003 RPS => 0,003 * 5 = 0,015 кб/c
  - 0,00009 * 31 000 000 * 5 = 14мб трафика в день
- Рекомендации (10тыс rps)
  - 10тыс rps на весь контент. При этом только 63% тексты => 6300 rps рекомендаций => 6300 * 5 = 31 мб/c
  - При просмотре статьи в конце предоставляют 4 поста на выбор, после идёт следующий пост ~= 4кб
  - За раз на стену приходит 7 рекомендованных постов ~= 7кб
  - В среднем получаем 5 постов за 1 рекомендацию с картинками ~= 5кб
  - В пике 6 300 * 2,2 = 13 900 rps => 13 900 * 5 кб = 70 мб/с в пике
  - 6 300 rps * 86 400 секунд в дне * 5 кб ответ = 3,8 Тб трафика в день
- Поиск
  - Пусть вес запроса будет 5кб
  - 0,27 * 31 000 000 DAU / 86 400 сек = 96 RPS * 5кб = 0,5 мб/c в среднем
  - В пике 96 * 2,2 = 211 RPS * 5кб = 1,1 мб/c в пике
  - 0,27 * 31 000 000 DAU * 5 кб = 42 Гб трафика в день

## 3. Глобальная баласировка

На основе следующих данных[20]:
34% — Москва и Питер
25% — города более >1М
11% — города 500 тыс - 1 млн
30% — остальное

Разместим сервис в ДЦ для быстрого доступа 70% пользователям.
Выбраны 4 дц что бы захватывать большую часть городов от 500тыс [18]
<img width="1111" height="578" alt="ДЦ Дзен" src="https://github.com/user-attachments/assets/3ecea877-d6da-4b61-9823-63ba6e64afa7" />
Города так же выбраны на основе магистралей - наибольшие выходы именно из этих городов [19]
<img width="1033" height="362" alt="ДЦ Магистрали сжата" src="https://github.com/user-attachments/assets/6748d0ce-2815-457f-94be-34ae72937690" />

Распрежделение нагрузки по ДЦ:

|Сервер|Нагрузка|Обоснование|
|--|--|--|
|Москва|64,5%|34% + 12,5% (половина городов милионников) + 5% (половина полумилионников) + 13% (остаток)|
|Екатеринбург|17,3%|8,3% (1/3 милионников) + 2%(и полумилионников) + 7%(остаток)|
|Новосибирск|13,2%|4,2% (милионники) + 3% (полумилионники) + 6%(остаток)|
|Владивосток|5%|1% + 4%(остаток)|

DNS балансировка latency based, что бы уменьшить задержки

anycast не будем использовать т.к. есть ip от ДЦ (см презентацию яндекс - уних всего 8 ip по 1 на каждый ДЦ)

## Ссылки

1. https://www.youtube.com/watch?v=IXEde53P0Jg - 1:38
2. https://zenstat.ru/stat/posts/?search=&sort=views&order=asc&offset=0&limit=50&type_post=card&date_from=2025-08-06&date_to=2025-09-04&period=30&post_text=&post_text_minus=&views_min=&views_max=&channel_subscribers_min=&channel_subscribers_max=&channel_publications_30days=&fast_load=1
3. https://dzen.ru/about
4. https://habr.com/ru/news/532670/
5. https://dzen.ru/about/itogi2023
6. https://dzen.ru/itogi-2024
7. https://corp.vkcdn.ru/media/files/RUS_Results_Presentation_H1_2025.pdf - 7 стр
8. https://hypestat.com/info/dzen.ru
9. https://dzen.ru/about/careers
10. https://dzen.ru/a/ZYWi7bChZQJnLS9d
11. https://dzen.ru/a/aH3qbkqCAA5vD3ht
12. https://zenstat.ru/stat/channels/
13. https://habr.com/ru/articles/914310/
14. https://searchengines.guru/ru/news/2057604?utm_medium=organic&utm_source=yandexsmartcamera
15. https://dzen.ru/a/ZYWi7bChZQJnLS9d


[1]: https://www.youtube.com/watch?v=IXEde53P0Jg
[2]: https://zenstat.ru/stat/posts/?search=&sort=views&order=asc&offset=0&limit=50&type_post=card&date_from=2025-08-06&date_to=2025-09-04&period=30&post_text=&post_text_minus=&views_min=&views_max=&channel_subscribers_min=&channel_subscribers_max=&channel_publications_30days=&fast_load=1
[3]: https://dzen.ru/about
[4]: https://habr.com/ru/news/532670/
[5]: https://dzen.ru/about/itogi2023
[6]: https://dzen.ru/itogi-2024
[7]: https://corp.vkcdn.ru/media/files/RUS_Results_Presentation_H1_2025.pdf
[8]: https://hypestat.com/info/dzen.ru
[9]: https://dzen.ru/about/careers
[10]: https://dzen.ru/a/ZYWi7bChZQJnLS9d
[11]: https://dzen.ru/a/aH3qbkqCAA5vD3ht
[12]: https://zenstat.ru/stat/channels/
[13]: https://habr.com/ru/articles/914310/
[14]: https://searchengines.guru/ru/news/2057604?utm_medium=organic&utm_source=yandexsmartcamera
[15]: https://dzen.ru/a/ZYWi7bChZQJnLS9d
[16]: https://www.cnews.ru/news/line/2022-12-23_dzen_podvel_itogi_2022_goda
[17]: https://supa.ru/blog/posts/v-2019-ghodu-iandieks-dzien-udvoil-mnoghiie-pokazatieli
[18]: https://ru.wikipedia.org/wiki/%D0%93%D0%BE%D1%80%D0%BE%D0%B4%D0%B0_%D0%A0%D0%BE%D1%81%D1%81%D0%B8%D0%B8_%D1%81_%D0%BD%D0%B0%D1%81%D0%B5%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5%D0%BC_%D0%B1%D0%BE%D0%BB%D0%B5%D0%B5_500_%D1%82%D1%8B%D1%81%D1%8F%D1%87_%D1%87%D0%B5%D0%BB%D0%BE%D0%B2%D0%B5%D0%BA
[19]: https://www.comnews.ru/content/211042/2020-10-21/2020-w43/magistralnye-seti-svyazi-rossii
[20]: https://leadmachine.ru/2020/08/05/content-marketing-vs-yandex-dzen/?utm_medium=organic&utm_source=yandexsmartcamera
